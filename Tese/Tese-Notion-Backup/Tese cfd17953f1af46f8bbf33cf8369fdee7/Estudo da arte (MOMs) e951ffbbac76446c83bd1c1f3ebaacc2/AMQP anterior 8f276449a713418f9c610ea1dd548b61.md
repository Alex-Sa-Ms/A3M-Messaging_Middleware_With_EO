# AMQP anterior

***Advanced Message Queuing Protocol***

---

**Table of Contents**

# Visão Geral

- Protocolo (nível de aplicação) designado para *message-oriented middleware*.
- Funcionalidades: message orientation, queueing, routing (point-to-point and publish-subscribe), reliability and security.
- Obriga a que diferentes implementações sejam **interoperáveis**.
- **Wire-level protocol**, i.e., descreve o formato dos dados enviados pela rede como stream de bytes.
- Fornece:
    - Controlo de fluxo
    - Garantias de entrega: *at-most-once*, *at-least-once* e *exactly-once*
    - Autenticação e/ou encriptação (SASL e/ou TLS)
- Assume um protocolo de transporte confiável, como o TCP (**Exon** poderá ser uma opção também)

---

# Especificação

### Sistema de tipos

Define um esquema de codificação para permitir representações, interoperáveis, de uma vasta gama de tipos usados frequentemente.

- Permite anotações adicionais para que dados tipados possam ser interpretados de diferentes formas, como por exemplo um mapa de key-values ser interpretado como a representação de tipo ‘customer’.

O sistema de tipos é usado para definir um formato de mensagens que permite expressar metadata padronizada e extendida, e dessa forma ser entendida pelas entidades de processamento.

### *Link* protocol

- Unidade básica de dados para AMQP é o *frame.* Existem 9 tipos de *frame bodies* para iniciar, controlar e destruir a transferência de mensagens entre dois *peers:*
    - open (the *connection*);
    - begin (the *session*);
    - attach (the *link*) : usado para criar um novo *link;*
    - transfer : usando um *link* estabelecido, permite enviar uma mensagem;
    - flow;
    - disposition;
    - detach (the *link*) : usado para destruir um *link;*
    - end (the *session*);
    - close (the *connection*).
- *Links* são estabelecidos para receber e enviar mensagens.
- Transferências são controladas por um esquema de créditos para controlar o fluxo. São geridas através dos *flow frames.* Controlo de fluxo permite evitar que o receptor seja bombardeado com mensagens, e também para permitir a escolha de quando receber mensagens.
- Cada mensagem deve, eventualmente, ser *settled.* O transmissor e o receptor devem concordar no estado da transferência, de forma a fornecer garantias de confiabilidade (*at-most-once, at-least-once* e *exactly-once*). Mudanças no estado e *settlement* de uma transferência(s) são comunicadas utilizando *disposition frames.*
- Múltiplos *links,* em ambas as direções, podem ser agrupados em *sessions.* Uma sessão é uma conversa bidirecional e sequencial entre 2 *peers,* começada com um *begin frame* e terminada com um *end frame.* Uma *connection* entre 2 *peers* pode conter múltiplas *sessions* multiplexadas e logicamente independentes. *Connections* são iniciadas com um *open frame,* no qual as capacidades do transmissor são expressadas, e terminadas com um *close frame.*

### Formato das mensagens

Contém uma parte designada por *bare message,* que é imutável para permitir signing e/ou encriptação e ainda para que as verificações de integridade se mantenham válidas. É, no entanto, possível que intermediários adicionem anotações antes ou depois da *bare message.*

Esta parte pode ser vista, mais em concreto, na especificação do protocolo (presente nas referências).

### Funcionalidades das mensagens

---

### Referências:

[https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol)

[https://web.archive.org/web/20141010172100/http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-overview-v1.0-os.html](https://web.archive.org/web/20141010172100/http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-overview-v1.0-os.html) (por ver)

[AMQP 1.0 Specification](AMQP%20anterior%208f276449a713418f9c610ea1dd548b61/AMQP%201%200%20Specification%20a0c5461a076c457a922762bd26ea16b0.md)

[https://web.archive.org/web/20190620095529/www.imatix.com/articles:whats-wrong-with-amqp](https://web.archive.org/web/20190620095529/www.imatix.com/articles:whats-wrong-with-amqp)